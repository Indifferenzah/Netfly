document.getElementById("year").textContent=(new Date).getFullYear();const sections=Array.from(document.querySelectorAll("main section[id]")),navLinks=Array.from(document.querySelectorAll("#nav-links a")),titleMap={home:"Home | Valiance",about:"Chi siamo | Valiance",roster:"Staff | Valiance",events:"Eventi | Valiance",rules:"Regole | Valiance",gallery:"Galleria | Valiance",status:"Server | Valiance",discord:"Discord | Valiance",contact:"Contatti | Valiance"},setActive=e=>navLinks.forEach(t=>t.classList.toggle("active",t.getAttribute("href")==="#"+e)),obs=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(setActive(e.target.id),document.title=titleMap[e.target.id]||"Valiance")})},{threshold:.55});sections.forEach(e=>obs.observe(e));const parallax=document.getElementById("parallax"),depthNodes=parallax?Array.from(parallax.querySelectorAll("[data-depth]")):[];let mouseX=0,mouseY=0,rafId=0;function onMove(e){const t=document.body.getBoundingClientRect();mouseX=(e.clientX-t.width/2)/t.width,mouseY=(e.clientY-window.innerHeight/2)/window.innerHeight,rafId||(rafId=requestAnimationFrame(updateParallax))}function updateParallax(){depthNodes.forEach(e=>{const t=parseFloat(e.dataset.depth||"0"),n=-mouseX*t*30,o=-mouseY*t*30;e.style.transform=`translate3d(${n}px, ${o}px, 0)`}),rafId=0}window.addEventListener("mousemove",onMove,{passive:!0});const canvas=document.getElementById("fx"),ctx=canvas.getContext("2d");let W,H,particles=[],clickParticles=[];function resize(){W=canvas.width=innerWidth,H=canvas.height=innerHeight}function rand(e,t){return Math.random()*(t-e)+e}function colorMix(e){return`rgba(${34+105*e}, ${211-119*e}, ${238- -8*e}, ${.16+.12*Math.sin(performance.now()/800)})`}function spawn(e=!1){const t=Math.max(120,Math.floor(W*H/1e4));for(e&&(particles=[]);particles.length<t;)particles.push({x:rand(0,W),y:rand(0,H),vx:rand(-.2,.2),vy:rand(.15,.45),r:rand(.6,2.2)})}window.addEventListener("resize",()=>{resize(),spawn(!0)});let mx=0,my=0;function step(){ctx.clearRect(0,0,W,H);const e=(Math.sin(performance.now()/1200)+1)/2;particles.forEach(t=>{t.vx+=.02*(Math.random()-.5),t.vy+=.01+.01*(Math.random()-.5),t.x+=t.vx,t.y+=t.vy,t.vx*=.95,t.vy*=.95,t.x<-10&&(t.x=W+10),t.x>W+10&&(t.x=-10),t.y<-10&&(t.y=H+10),t.y>H+10&&(t.y=-10),ctx.beginPath(),ctx.fillStyle=colorMix(e),ctx.arc(t.x,t.y,t.r,0,2*Math.PI),ctx.fill()}),clickParticles=clickParticles.filter(e=>(e.x+=e.vx,e.y+=e.vy,e.vx*=.98,e.vy*=.98,e.life--,e.life>0&&(ctx.beginPath(),ctx.fillStyle=`rgba(34, 211, 238, ${e.life/120})`,ctx.arc(e.x,e.y,e.r,0,2*Math.PI),ctx.fill(),!0))),requestAnimationFrame(step)}window.addEventListener("mousemove",e=>{mx=e.clientX,my=e.clientY;for(let t=0;t<2;t++)clickParticles.push({x:e.clientX+rand(-10,10),y:e.clientY+rand(-10,10),vx:rand(-2,2),vy:rand(-2,2),r:rand(1,3),life:60})}),window.addEventListener("click",e=>{for(let t=0;t<10;t++)clickParticles.push({x:e.clientX+rand(-20,20),y:e.clientY+rand(-20,20),vx:rand(-4,4),vy:rand(-4,4),r:rand(2,5),life:120})}),resize(),spawn(!0),step();const ipEl=document.getElementById("server-ip"),ip=ipEl.textContent.trim();async function fetchStatus(e){try{const t=await fetch(`https://api.mcstatus.io/v2/status/java/${encodeURIComponent(e)}`);if(!t.ok)throw new Error("HTTP "+t.status);const n=await t.json(),o=document.getElementById("status-dot"),a=document.getElementById("status-text"),i=document.getElementById("players-online");n?.online?(o.classList.add("online"),a.textContent="Online",i.textContent=n.players?.online??0,document.getElementById("server-version").textContent=n.version?.name_raw||"N/D"):(o.classList.remove("online"),a.textContent="Offline",i.textContent="--")}catch(e){console.warn("Status fetch failed",e)}}async function applyDiscordAvatars(){const e=Array.from(document.querySelectorAll(".member[data-discord-id]"));await Promise.all(e.map(async e=>{const t=e.getAttribute("data-discord-id"),n=e.querySelector(".avatar"),o=()=>{try{const e=`https://cdn.discordapp.com/embed/avatars/${Number((BigInt(t)>>22n)%6n)}.png`;n.style.background=`center / cover no-repeat url('${e}')`,n.style.border="1px solid #1f3a5a",n.textContent=""}catch(e){n.textContent=""}};try{const e=(window.location.hostname.includes("vercel.app"),`/api/get-avatar?id=${encodeURIComponent(t)}`),a=await fetch(e);if(!a.ok)return o();const i=await a.json(),r=i?.url;if(!r)return o();n.style.background=`center / cover no-repeat url('${r}')`,n.style.border="1px solid #1f3a5a",n.textContent=""}catch{o()}}))}ip&&"play.tuo-server.it"!==ip&&fetchStatus(ip),applyDiscordAvatars(),[{url:"https://discord.com/api/guilds/1350073876339490826/widget.json",onlineEl:"#discord1-online",totalEl:"#discord1-total"},{url:"https://discord.com/api/guilds/1436756175310950588/widget.json",onlineEl:"#discord2-online",totalEl:"#discord2-total"}].forEach(async({url:e,onlineEl:t,totalEl:n})=>{const o=document.querySelector(t),a=document.querySelector(n);try{const t=await fetch(e,{cache:"no-store"});if(!t.ok)throw new Error("HTTP "+t.status);const n=await t.json(),i="number"==typeof n.presence_count?n.presence_count:n.members?.length??"N/D",r=n.approximate_member_count||"N/D";o&&(o.textContent=i),a&&(a.textContent=r)}catch(e){o&&(o.textContent="N/D"),a&&(a.textContent="N/D")}}),function(){const e=Array.from(document.querySelectorAll(".member")),t=document.getElementById("notification");function n(){t.classList.add("show"),setTimeout(()=>{hideNotification()},3e3)}window.hideNotification=function(){t.classList.remove("show")},e.forEach(e=>{e.style.cursor="pointer",e.addEventListener("click",async()=>{const t=e.getAttribute("data-discord-id");if(t)try{await navigator.clipboard.writeText(t),n()}catch(e){const o=document.createElement("textarea");o.value=t,document.body.appendChild(o),o.select();try{document.execCommand("copy"),n()}finally{document.body.removeChild(o)}}})})}();const mobileMenuBtn=document.getElementById("mobile-menu-btn"),mobileMenuOverlay=document.getElementById("mobile-menu-overlay"),mobileMenuClose=document.getElementById("mobile-menu-close"),mobileMenuLinks=mobileMenuOverlay.querySelectorAll("a");function toggleMobileMenu(){mobileMenuOverlay.classList.toggle("show")}function closeMobileMenu(){mobileMenuOverlay.classList.remove("show")}mobileMenuBtn.addEventListener("click",toggleMobileMenu),mobileMenuClose.addEventListener("click",closeMobileMenu),mobileMenuLinks.forEach(e=>{e.addEventListener("click",closeMobileMenu)});