<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forum | Valiance</title>
  <meta name="description" content="Forum del Clan Valiance. Discuti con la community!" />
  <link rel="icon" href="/pfp.png" />
  <link rel="stylesheet" href="../css/index.min.css">
  <link rel="stylesheet" href="forum.css">
</head>

<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <svg class="logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#22d3ee" />
              <stop offset="100%" stop-color="#8b5cf6" />
            </linearGradient>
          </defs>
          <path d="M3 12l6.5-6.5L12 8l2.5-2.5L21 12l-2 2-4.5-4.5L12 12l-2.5-2.5L5 14l-2-2z" fill="url(#g)" />
        </svg>
        <span>Valiance</span>
      </div>
      <nav>
        <ul id="nav-links" style="margin-top: 10px;">
          <li><a href="../">Home</a></li>
          <li><a href="/forum/login.html" id="login-btn">Login</a></li>
          <li><a href="#" id="profile-btn" style="display:none;">Profilo</a></li>
          <li><a href="#" id="logout-btn" style="display:none;">Logout</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main style="padding-top: 70px;">
    <div class="container">
      <h1>Forum Valiance</h1>
      <div class="forum-layout">
        <div class="forum-content" id="forum-content">
          <div class="category">
            <h3>Generale</h3>
            <div class="subcategory-grid">
              <div class="subcategory-card" onclick="loadThreads('chat')">
                <div class="subcategory-icon" style="background: linear-gradient(45deg, #22d3ee, #8b5cf6);"></div>
                <div class="subcategory-title">Chat</div>
                <div class="subcategory-desc">Discussioni generali e chiacchiere</div>
              </div>
              <div class="subcategory-card" onclick="loadThreads('supporto')">
                <div class="subcategory-icon" style="background: linear-gradient(45deg, #10b981, #059669);"></div>
                <div class="subcategory-title">Supporto</div>
                <div class="subcategory-desc">Aiuto e assistenza tecnica</div>
              </div>
              <div class="subcategory-card" onclick="loadThreads('suggerimenti')">
                <div class="subcategory-icon" style="background: linear-gradient(45deg, #f59e0b, #d97706);"></div>
                <div class="subcategory-title">Suggerimenti</div>
                <div class="subcategory-desc">Idee per migliorare il clan</div>
              </div>
            </div>
          </div>
          <div class="category">
            <h3>Bacheca</h3>
            <div class="subcategory-grid">
              <div class="subcategory-card" onclick="loadThreads('annunci')">
                <div class="subcategory-icon" style="background: linear-gradient(45deg, #ef4444, #dc2626);"></div>
                <div class="subcategory-title">Annunci</div>
                <div class="subcategory-desc">Comunicazioni ufficiali</div>
              </div>
              <div class="subcategory-card" onclick="loadThreads('changelogs')">
                <div class="subcategory-icon" style="background: linear-gradient(45deg, #8b5cf6, #7c3aed);"></div>
                <div class="subcategory-title">Changelogs</div>
                <div class="subcategory-desc">Aggiornamenti e novit√†</div>
              </div>
              <div class="subcategory-card" onclick="loadThreads('eventi')">
                <div class="subcategory-icon" style="background: linear-gradient(45deg, #06b6d4, #0891b2);"></div>
                <div class="subcategory-title">Eventi</div>
                <div class="subcategory-desc">Eventi e competizioni</div>
              </div>
            </div>
          </div>
          <button class="btn primary" id="new-thread-btn" style="display:none;">Nuovo Thread</button>
          <div id="threads-list"></div>
          <div id="thread-view" style="display:none;"></div>
        </div>
        <div class="forum-sidebar">
          <div class="online-users">
            <h4>Utenti Online</h4>
            <div id="online-users-list">
              <!-- Online users will be populated by JS -->
            </div>
          </div>
          <iframe src="https://discord.com/widget?id=1350073876339490826&theme=dark" width="350" height="500"
            allowtransparency="true" frameborder="0"
            sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"></iframe>
        </div>
      </div>
    </div>
  </main>



  <script type="module">
    import { getCurrentUser, signOut, onAuthStateChange } from './auth.js';

    let currentUser = null;

    onAuthStateChange((event, session) => {
      currentUser = session?.user || null;
      window.setCurrentUser(currentUser); // Set current user in forum.js
      updateUI();
    });

    function updateUI() {
      const loginBtn = document.getElementById('login-btn');
      const profileBtn = document.getElementById('profile-btn');
      const logoutBtn = document.getElementById('logout-btn');
      const newThreadBtn = document.getElementById('new-thread-btn');

      if (currentUser) {
        loginBtn.style.display = 'none';
        profileBtn.style.display = 'inline';
        logoutBtn.style.display = 'inline';
        newThreadBtn.style.display = 'inline';
      } else {
        loginBtn.style.display = 'inline';
        profileBtn.style.display = 'none';
        logoutBtn.style.display = 'none';
        newThreadBtn.style.display = 'none';
      }
    }

    document.getElementById('logout-btn').addEventListener('click', async () => {
      await signOut();
      window.location.href = 'login.html';
    });

  // Initialize
  document.addEventListener('DOMContentLoaded', async () => {
    const user = await getCurrentUser();
    window.setCurrentUser(user); // Set current user in forum.js
    // Allow viewing forum without login, but hide create button if not logged in
    if (!user) {
      document.getElementById('new-thread-btn').style.display = 'none';
    }
  });
  </script>
  <script src="forum.js"></script>
</body>
</html>
