<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forum | Valiance</title>
  <meta name="description" content="Forum del Clan Valiance. Discuti con la community!" />
  <link rel="icon" href="/pfp.png" />
  <link rel="stylesheet" href="../css/index.min.css">
  <style>
    body {
      background: linear-gradient(135deg, #0a0e1a 0%, #070b10 50%, #0b1220 100%);
    }
    .forum-layout {
      display: grid;
      grid-template-columns: 3fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    .forum-content {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 20px;
    }
    .forum-sidebar {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 20px;
    }
    .category {
      margin-bottom: 20px;
    }
    .category h3 {
      margin: 0 0 10px;
      color: var(--brand);
    }
    .subcategory-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-left: 20px;
    }
    .subcategory-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      cursor: pointer;
    }
    .subcategory-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(34, 211, 238, 0.2);
    }
    .subcategory-icon {
      width: 40px;
      height: 40px;
      margin-bottom: 10px;
      border-radius: 8px;
      background: var(--brand);
      display: inline-block;
    }
    .subcategory-title {
      font-weight: bold;
      margin-bottom: 5px;
      color: var(--text);
    }
    .subcategory-desc {
      color: var(--muted);
      font-size: 14px;
    }
    .thread {
      padding: 10px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .thread:last-child {
      border-bottom: none;
    }
    .thread-title {
      font-weight: bold;
    }
    .thread-meta {
      color: var(--muted);
      font-size: 14px;
    }
    .login-modal, .profile-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 20px;
      width: 400px;
      max-width: 90vw;
    }
    .modal-content h2 {
      margin-top: 0;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
    }
    .form-group input, .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg);
      color: var(--text);
    }
    .btn {
      margin-right: 10px;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .bbcode-toolbar {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .bbcode-toolbar button {
      padding: 5px 10px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    .bbcode-toolbar button:hover {
      background: var(--brand);
      color: white;
    }
    .online-users {
      margin-bottom: 20px;
    }
    .online-users h4 {
      margin: 0 0 10px;
    }
    .user-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: var(--brand);
    }
    .discord-widget {
      border-radius: 8px;
      overflow: hidden;
    }
    @media (max-width: 768px) {
      .forum-layout {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <svg class="logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#22d3ee" />
              <stop offset="100%" stop-color="#8b5cf6" />
            </linearGradient>
          </defs>
          <path d="M3 12l6.5-6.5L12 8l2.5-2.5L21 12l-2 2-4.5-4.5L12 12l-2.5-2.5L5 14l-2-2z" fill="url(#g)" />
        </svg>
        <span>Valiance</span>
      </div>
      <nav>
        <ul id="nav-links" style="margin-top: 10px;">
          <li><a href="../">Home</a></li>
          <li><a href="login.html" id="login-btn">Login</a></li>
          <li><a href="#" id="profile-btn" style="display:none;">Profilo</a></li>
          <li><a href="#" id="logout-btn" style="display:none;">Logout</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main style="padding-top: 70px;">
    <div class="container">
      <h1>Forum Valiance</h1>
      <div class="forum-layout">
        <div class="forum-content" id="forum-content">
          <div class="category">
            <h3>Generale</h3>
            <div class="subcategory-grid">
              <div class="subcategory-card" onclick="loadThreads('chat')">
                <div class="subcategory-icon" style="background: linear-gradient(45deg, #22d3ee, #8b5cf6);"></div>
                <div class="subcategory-title">Chat</div>
                <div class="subcategory-desc">Discussioni generali e chiacchiere</div>
              </div>
              <div class="subcategory-card" onclick="loadThreads('supporto')">
                <div class="subcategory-icon" style="background: linear-gradient(45deg, #10b981, #059669);"></div>
                <div class="subcategory-title">Supporto</div>
                <div class="subcategory-desc">Aiuto e assistenza tecnica</div>
              </div>
              <div class="subcategory-card" onclick="loadThreads('suggerimenti')">
                <div class="subcategory-icon" style="background: linear-gradient(45deg, #f59e0b, #d97706);"></div>
                <div class="subcategory-title">Suggerimenti</div>
                <div class="subcategory-desc">Idee per migliorare il clan</div>
              </div>
            </div>
          </div>
          <div class="category">
            <h3>Bacheca</h3>
            <div class="subcategory-grid">
              <div class="subcategory-card" onclick="loadThreads('annunci')">
                <div class="subcategory-icon" style="background: linear-gradient(45deg, #ef4444, #dc2626);"></div>
                <div class="subcategory-title">Annunci</div>
                <div class="subcategory-desc">Comunicazioni ufficiali</div>
              </div>
              <div class="subcategory-card" onclick="loadThreads('changelogs')">
                <div class="subcategory-icon" style="background: linear-gradient(45deg, #8b5cf6, #7c3aed);"></div>
                <div class="subcategory-title">Changelogs</div>
                <div class="subcategory-desc">Aggiornamenti e novit√†</div>
              </div>
              <div class="subcategory-card" onclick="loadThreads('eventi')">
                <div class="subcategory-icon" style="background: linear-gradient(45deg, #06b6d4, #0891b2);"></div>
                <div class="subcategory-title">Eventi</div>
                <div class="subcategory-desc">Eventi e competizioni</div>
              </div>
            </div>
          </div>
          <button class="btn primary" id="new-thread-btn" style="display:none;">Nuovo Thread</button>
          <div id="threads-list"></div>
          <div id="thread-view" style="display:none;"></div>
        </div>
        <div class="forum-sidebar">
          <div class="online-users">
            <h4>Utenti Online</h4>
            <div id="online-users-list">
              <!-- Online users will be populated by JS -->
            </div>
          </div>
          <iframe src="https://discord.com/widget?id=1350073876339490826&theme=dark" width="350" height="500"
            allowtransparency="true" frameborder="0"
            sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"></iframe>
        </div>
      </div>
    </div>
  </main>



  <script type="module">
    import { getCurrentUser, signOut, onAuthStateChange } from './auth.js';

    let currentUser = null;

    onAuthStateChange((event, session) => {
      currentUser = session?.user || null;
      window.setCurrentUser(currentUser); // Set current user in forum.js
      updateUI();
    });

    function updateUI() {
      const loginBtn = document.getElementById('login-btn');
      const profileBtn = document.getElementById('profile-btn');
      const logoutBtn = document.getElementById('logout-btn');
      const newThreadBtn = document.getElementById('new-thread-btn');

      if (currentUser) {
        loginBtn.style.display = 'none';
        profileBtn.style.display = 'inline';
        logoutBtn.style.display = 'inline';
        newThreadBtn.style.display = 'inline';
      } else {
        loginBtn.style.display = 'inline';
        profileBtn.style.display = 'none';
        logoutBtn.style.display = 'none';
        newThreadBtn.style.display = 'none';
      }
    }

    document.getElementById('logout-btn').addEventListener('click', async () => {
      await signOut();
      window.location.href = 'login.html';
    });

  // Initialize
  document.addEventListener('DOMContentLoaded', async () => {
    const user = await getCurrentUser();
    window.setCurrentUser(user); // Set current user in forum.js
    // Allow viewing forum without login, but hide create button if not logged in
    if (!user) {
      document.getElementById('new-thread-btn').style.display = 'none';
    }
  });
  </script>
  <script src="forum.js"></script>
</body>
</html>
